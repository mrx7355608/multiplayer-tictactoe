<style>
    #board {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 130px;
        height: 130px;
        flex-wrap: wrap;
    }

    .cell {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border: 1px solid black;
        cursor: pointer;
    }

    .cell:hover {
        background-color: lightgray;
    }
</style>
<h1>Room page</h1>
<p id="user1-name">User 1: Waiting for a user to join...</p>
<p id="user2-name">User 2: Waiting for a user to join...</p>
<h2 id="game-over-screen"></h2>
<div id="board"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io({ autoReconnect: false });

    socket.emit("play-game")

    const user1Name = document.getElementById("user1-name");
    const user2Name = document.getElementById("user2-name");
    const boardDiv = document.getElementById("board");
    const gameOverScreen = document.getElementById("game-over-screen");

    socket.on("new-user-joined", ({ room }) => {
        if (room.user1) {
            user1Name.innerText = `User 1: ${room.user1}`
        }
        if (room.user2) {
            user2Name.innerText = `User 2: ${room.user2}`;
        }
    })

    socket.on("player-left", ({ room }) => {
        if (room.user1 === null) {
            user1Name.innerText = `User 1: left the game`
        }
        if (room.user2 === null) {
            user2Name.innerText = `User 2: left the game`;
        }
        clearBoard();
    })

    socket.on("start-game", ({ room }) => {
        drawBoard(room.board);
    })

    function drawBoard(board) {
        for(let i = 0; i < 3; i++) {
            for(let j = 0; j < 3; j++) {
                const boardCell = document.createElement("div");
                boardCell.setAttribute("class", "cell");

                boardCell.innerText = board[i][j];


                if(board[i][j]) {
                    boardCell.innerText = board[i][j];
                    boardCell.removeEventListener("click", () => {
                        makeMove(i, j);
                    })
                } else {
                    boardCell.innerText = "";
                    boardCell.addEventListener("click", () => {
                        makeMove(i, j);
                    })
                }
                boardDiv.appendChild(boardCell);
            }
        }
    }

    function clearBoard() {
        Array.from(boardDiv.childNodes).forEach(e => {
            e.remove();
        })
    }

    function makeMove(row, col) {
        socket.emit("player-made-a-move", { row, col });
    }


    socket.on("board-updated", ({ board }) => {
        clearBoard();
        drawBoard(board);
    })

    socket.on("game-over", ({ winner }) => {
        clearBoard();
        gameOverScreen.innerText = `${winner} has won the game`;
    })

</script>
